<template>
    <div class="slds-grid slds-wrap">

        <template if:true={isLoading}>
            <lightning-spinner alternative-text="tab is loading">
            </lightning-spinner>
        </template>

        <div class="slds-size_1-of-1 slds-medium-size_3-of-12 slds-large-size_3-of-12 slds-p-around_large slds-border_right">
            <template if:true={isLoading}>
                <c-util-stencil row-count="10"
                                column-count="1">
                </c-util-stencil>
            </template>
            <template if:false={isLoading}>
                <h2 class="slds-text-heading_small slds-p-bottom_small">Select Batch Fields</h2>
                <p class="slds-text-body_small slds-p-bottom_small">
                    Select the fields for capturing batch information. Manage these fields in the
                    NPSP Batch Data Import settings in Object Manager.
                </p>

                <template for:each={batchFields}
                          for:item="field">
                    <lightning-input checked={field.checked}
                                     class="slds-truncate"
                                     data-type={field.dataType}
                                     disabled={field.isRequiredFieldDisabled}
                                     key={field.apiName}
                                     label={field.label}
                                     onchange={handleToggleBatchField}
                                     required={field.required}
                                     title={field.label}
                                     type="checkbox"
                                     value={field.apiName}>
                    </lightning-input>
                </template>
            </template>
        </div>

        <div class="slds-size_1-of-1 slds-medium-size_9-of-12 slds-large-size_9-of-12 slds-p-around_large slds-border_left">
            <template if:true={isLoading}>
                <c-util-stencil row-count="10"
                                column-count="4">
                </c-util-stencil>
            </template>
            <template if:false={isLoading}>
                <div class="slds-grid slds-wrap slds-grid_vertical-align-end">
                    <template if:true={hasErrors}>
                        <div class="slds-size_1-of-1 slds-p-bottom_small">
                            <c-util-page-level-message title="Heads up!"
                                                     subtitle="These required fields were automatically added to the Batch Header: "
                                                     variant='warning'>
                                <ul slot="body" class="slds-list_dotted">
                                    <template for:each={missingRequiredFields}
                                              for:item="missingRequiredField">
                                        <li key={missingRequiredField.apiName}>
                                            {missingRequiredField.label}
                                        </li>
                                    </template>
                                </ul>
                            </c-util-page-level-message>
                        </div>
                    </template>
                    <div class="slds-size_1-of-1 slds-p-bottom_small">
                        <h2 class="slds-text-heading_small slds-p-bottom_small">Set Batch Field Values</h2>
                        <p class="slds-text-body_small">
                            Mark require batch fields and enable default values for user input. Please note that
                            any default values can be overwritten by the gift entry user. Reorder fields by using
                            the arrow icons on the right.
                        </p>
                    </div>

                    <div class="slds-size_1-of-1 slds-p-bottom_small">
                        <div class="slds-grid slds-grid_vertical-align-center">
                            <div class="slds-size_5-of-12">
                                Field Label
                            </div>
                            <div class="slds-size_1-of-12">
                                Required
                            </div>
                            <div class="slds-size_5-of-12">
                                Default Value
                            </div>
                            <div class="slds-size_1-of-12">
                            </div>
                        </div>

                        <template iterator:it={selectedBatchFields}>
                            <c-ge-template-builder-form-field key={it.value.apiName}
                                                              field={it.value}
                                                              object-api-name={dataImportBatchName}
                                                              is-first={it.first}
                                                              is-last={it.last}
                                                              onupdatepicklistoptions={handleUpdateBatchHeaderField}
                                                              onformelementup={handleFormElementUp}
                                                              onformelementdown={handleFormElementDown}
                                                              onupdateformelement={handleUpdateBatchHeaderField}
                                                              ondeleteformelement={handleDeleteBatchHeaderField}>
                            </c-ge-template-builder-form-field>
                        </template>

                    </div>
                </div>
            </template>
        </div>
    </div>

</template>
